---
- hosts: all
  become: no
  any_errors_fatal: true
  gather_facts: no
  vars_files:
    - vars.yaml

  tasks:
    - name: Drop memory caches
      become: yes
      shell: >
        sync; echo 3 > /proc/sys/vm/drop_caches
      register: drop_caches_result
      until: drop_caches_result.rc == 0
      retries: 10
      delay: 5

    - name: Clean swap
      become: yes
      shell: >
        swapoff -a; swapon -a
      register: clean_swap_result
      until: clean_swap_result.rc == 0
      retries: 10
      delay: 5